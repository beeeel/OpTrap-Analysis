%% Spend some time writing down tRanges
% Get accumulated and dayDirs from bead_processing_accumulator_v1

% July 26 is pretty screwy.

dayIdx = 1;
cellIdx = 1;
fIdx = 1;

nP = 5;
highT = false;
timeDom = true;

if highT
    % Superdiffuse onset
    tRanges = get_tRanges_struct(dayDirs);
    wRanges = get_wRanges_struct(dayDirs);
else
    % Elastic plateau onset
    tRanges = get_low_tRanges_struct(dayDirs);
    wRanges = get_low_wRanges_struct(dayDirs);
end


tR = Range_getter(tRanges, dayDirs{dayIdx}, cellIdx, fIdx);
wR = Range_getter(wRanges, dayDirs{dayIdx}, cellIdx, fIdx);

fh = figure(204);
clf
fh.Name = sprintf('%s, cell %i of %i, rep %i of %i', dayDirs{dayIdx}, cellIdx, size(accumulated{dayIdx},2), fIdx, size(accumulated{dayIdx}{2,cellIdx},2));

if isfield(accumulated{dayIdx}{1,cellIdx}(fIdx) , 'msdRaw')
    msd = accumulated{dayIdx}{1,cellIdx}(fIdx).msdRaw;
else
    msd = accumulated{dayIdx}{1,cellIdx}(fIdx).msd;
end
warning('off','MATLAB:legend:IgnoringExtraEntries')
fps = cat(3,1,1);
if timeDom
    [tC, fps] = msd_cornerator(accumulated{dayIdx}{1,cellIdx}(fIdx).msd, accumulated{dayIdx}{2,cellIdx}(fIdx), tR, 'estimator','lsq', 'figHand', fh);
else
    [FT, oC] = msd_fourier_transformator(msd, accumulated{dayIdx}{2,cellIdx}(fIdx),'wRange',wR, 'fh', fh, 'show_int', true, 'yLims', [1e-6 1]);
end
N_extraPlots(nP, accumulated{dayIdx}{1,cellIdx}(fIdx).msd.msd, fps);
warning('on','MATLAB:legend:IgnoringExtraEntries')

%% Inspect data - system command to open imagej, plotting command for tracks, msd_colorfulplot for whole day MSDs.
% system(['imagej ' accumulated{dayIdx}{1,cellIdx}(fIdx).dirPath '/*/*.tif &'])
% figure(203), clf, for plt = 1:2; subplot(2,1,plt), plot(accumulated{dayIdx}{1,cellIdx}(fIdx).msd.tracks{plt}(:,2)); end
% msd_colorfulplot(accumulated,dayIdx,cellIdx,[]);
ratio = @(x) x(2)/x(1)/2;
fprintf('Radial 1st gradient %g,\tTangential 1st gradient %g\t\tframetime=%iμs, σ=%iμs\n',...
    ratio(accumulated{dayIdx}{1,cellIdx}(fIdx).msd.msd{1}(2:3,2)),...
    ratio(accumulated{dayIdx}{1,cellIdx}(fIdx).msd.msd{2}(2:3,2)),...
    round(accumulated{dayIdx}{1,cellIdx}(fIdx).msd.msd{1}(2,1)*1e6),...
    accumulated{dayIdx}{1,cellIdx}(fIdx).exp*1e3);


function [wRanges] = get_low_wRanges_struct(dayDirs)
% This has numbers from LatB data
wRanges = struct(strcat('d',dayDirs{end}), struct('c1', {{}}));

%% wRanges with 1 high-frequency corner

wRanges.d2022_02_01.c1 = {
    {} {}
    {} {}
    {} {}
    {} {}
    {} {}
    {} {}
    {} {}
    {} {}
    {} {}
    {} {}};
%     {[0.26 0.4]} {[0.04 0.21]}
%     {[10 100]} {[10 100]}
%     {[20 200]} {[20 200]}
%     {[10 100]} {[10 100]}
wRanges.d2022_01_18.c1 = {
    {[1e-2 3]} {[0.1 10]}
    {[5 50]} {[5 50]}
    {[50 300]} {[50 500]}
    {[50 300]} {[50 500]}
    {[10 1000]} {[10 1000]}
    {[10 1000]} {[10 1000]}};

wRanges.d2022_01_13.c1 = {
    {} {[2 1e3]}
    {[20 150]} {[10 300]}
    {[20 150]} {[10 300]}
    {[7 30]} {[10 200]}
    {[7 30]} {[10 200]}
    {[50 300]} {[50 500]}
    {[10 300]} {[40 500]}};

wRanges.d2022_01_13.c2 = {
    {[200 2000]} {[80 2000]}
    {[100 1000]} {[20 200]}
    {} {}
    {[30 200]} {[20 200]}
    {} {[4 80]}
    {} {[4 80]}
    {} {[4 80]}};

wRanges.d2022_01_11.c1 = {
    {[5 50]} {[5 50]}
    {[5 50]} {[5 50]}
    {} {[5 50]}
    {[50 200]} {[5 50]}
    {[100 400]} {[5 50]}
    {[100 400]} {[5 50]}
    {[20 200]} {[20 200]}};

wRanges.d2022_01_11.c2 = {
    {[10 100]} {[1 20]}
    {[10 100]} {[0.5 10]}
    {[10 100]} {[1 20]}
    {[5 200]} {[1 40]}
    {[10 100]} {[1 20]}
    {[10 200]} {[1 30]}
    {[10 200]} {[10 100]}};

wRanges.d2021_07_27.c2 = {...
    };
wRanges.d2021_07_27.c1 = {...
    };
wRanges.d2021_07_26.c1 = {...
    };
wRanges.d2021_07_23.c3 = {...
    };
wRanges.d2021_07_23.c2 = {...
    };
wRanges.d2021_07_23.c1 = {...
    };

%% wRanges with 2 corners
wRanges.d2021_07_27.c2 = {...
    {[2e-2 1] [5 1e2]} {[2e-2 1] [5 1e2]};
    {[2e-2 1] [5 1e2]} {[2e-2 1] [5 1e2]};
    {[2e-2 0.8] [8e2 2e3]} {[8 80] []};
    {[2e-2 0.8] [8e2 2e3]} {[8 80] []};
    {[2 10]} {[2 10]};
    {[2 10]} {[2 10]};
    {[1 7]} {[1 10]};
    {[1e-2 1.5e-1] [30 1e4]} {[2 10]};};
wRanges.d2021_07_27.c1 = {...
    {[1e-2 2] [200 2e3]} {[1e-2 5] [60 8e2]};
    {[1e-2 5] [500 5e4]} {[1e-2 6] [200 1e4]};
    {[1e-2 2] [8e2 2e3]} {[1e-2 1] [200 1e4]};
    {[1e-2 2] [8e2 2e3]} {[1e-1 2] [200 1e4]};
    {[1e-2 1] [8e2 2e3]} {[1e-2 1] [200 1e4]};
    {[1e-1 3] [20 1e2]} {[1e-2 1] [200 1e4]};
    {[1e-2 1] [6e2 2e3]} {[1e-2 1] [200 1e4]};
    {[1e-2 1] [6e2 2e3]} {[1e-2 1] [200 1e4]};
    {[1e-2 1] [6e2 2e3]} {[1e-2 1] [200 1e4]}};
wRanges.d2021_07_26.c1 = {...
    {[1e-2 10] [50 3e2]} {[1e-2 10] [20 8e2]};
    {[1e-2 5] [50 5e2]} {[1e-2 6] [20 8e2]};
    {[1e-2 10] [50 3e2]} {[1e-2 10] [20 8e2]};
    {[6e-2 2] [50 3e2]} {[6e-2 2] [20 8e2]};
    {[1e-2 1] [50 3e2]} {[1e-2 1] [20 8e2]};
    {[1e-1 3] [20 1e2]} {[1e-2 3] [20 2e2]};
    {[1e-1 3] [50 3e2]} {[1e-2 3] [50 3e2]};
    {[1e-1 3] [10 2e2]} {[1e-2 3] [10 2e2]}};
wRanges.d2021_07_23.c3 = {...
    {[100 1e4]} {[20 8e2]};
    {[100 1e4]} {[20 8e2]};
    {[100 1e4]} {[20 8e2]};
    {[100 1e4]} {[20 8e2]};
    {[100 1e4]} {[20 8e2]};
    {[100 1e4]} {[20 8e2]};
    {[1e-2 0.8] [100 1e4]} {[100 1e4]};
    {[100 1e4]} {[20 8e2]};
    {[100 1e4]} {[20 1e3]}};
wRanges.d2021_07_23.c2 = {...
    {[1e-2 1] [70 1e4]} {[5 80]};
    {[3 50]} {[2 30]};
    {[3 50]} {[0.5 5]};
    {[3 50]} {[0.5 5]};
    {[0.5 4]} {[0.5 4]};
    {[3e-1 5]} {[3e-1 3]};
    {[1 10]} {[1 10]}; %
    {[2e-1 10]} {[2e-1 8]};
    {[4e-1 3]} {[1e-1 3]};
    {[1 5]} {[1 5]};};
wRanges.d2021_07_23.c1 = {...
    {[1e-1 5]} {[1e-1 5]};
    {[5e-1 500]} {[1e-1 5]};
    {[1e-1 5]} {[1e-1 5]};
    {[1e-1 3]} {[1e-1 3]};
    {[1e-1 3]} {[1e-1 3]};
    {[1e-1 5]} {[1e-1 5]};
    {[1e-2 2]} {[1e-2 2]}; %
    {[1e-2 30]} {[1e-2 8]};
    {[1e-2 1] [20 200] [300 1e3]} {[1e-2 2]};
    {[1e-2 1] [20 200] [300 1e3]} {[1e-2 2]}};

end

function [tRanges] = get_low_tRanges_struct(dayDirs)
% This has numbers from LatB data
tRanges = struct(strcat('d',dayDirs{end}), struct('c1', {{}}));

%% Time ranges for elastic plateau onset

tRanges.d2022_02_01.c1 = {
    {[1e-2 1] [2 3]} {[1e-2 1] [2 3]}
    {[1e-2 1] [2 3]} {[1e-2 1] [2 3]}
    {[0.1 1] [4 20]} {[0.1 1] [4 20]}
    {[0.08 0.2] [4 20]} {[0.08 0.2] [4 20]}
    {[0.08 0.2] [4 20]} {[0.08 0.2] [4 20]}
    {[0.08 0.2] [4 20]} {[0.08 0.2] [4 20]}
    {[0.2 1] [10 40]} {[0.2 1] [10 40]}
    {[0.2 1] [10 40]} {[0.2 1] [10 40]}
    {[0.2 1] [10 40]} {[0.2 1] [10 40]}
    {[0.2 1] [10 40]} {[0.2 1] [10 40]}};
tRanges.d2022_01_18.c1 = {
    {[1e-2 1] [10 20]} {[1e-2 1] [8 30]}
    {[2e-3 1e-1] [0.3 2]} {[2e-3 1e-1] [0.3 2]}
    {[2e-3 2e-2] [0.1 1]} {[2e-3 1e-2] [0.1 1]}
    {[2e-3 2e-2] [0.1 1]} {[2e-3 1e-2] [0.1 1]}
    {[2e-3 2e-2] [0.1 1]} {[2e-3 1e-2] [0.1 1]}
    {[2e-3 2e-2] [0.1 1]} {[2e-3 1e-2] [0.1 1]}};

tRanges.d2022_01_13.c1 = {
    {} {}
    {[1e-3 1e-2] [0.2 1]} {[1e-3 1e-2] [0.2 0.4]} 
    {[1e-3 1e-2] [0.1 1]} {[1e-4 1e-2] [0.1 1]}
    {[1e-3 1e-2] [0.1 1]} {[1e-4 1e-2] [0.1 1]}
    {[1e-3 1e-2] [0.2 2]} {[1e-4 1e-2] [0.2 2]}
    {[1e-3 1e-2] [0.1 0.6]} {[1e-4 1e-2] [0.1 1]}
    {[1e-3 1e-2] [0.1 0.3]} {[1e-4 1e-2] [0.08 0.3]}};
tRanges.d2022_01_13.c2 = {
    {[1e-4 3e-3] [6e-2 2e-1]} {[1e-4 3e-3] [6e-2 2e-1]}
    {[1e-4 3e-3] [6e-2 1]} {[1e-4 3e-3] [6e-2 1]}
    {[1e-4 3e-3] [6e-2 1]} {[1e-4 3e-3] [6e-2 1]}
    {[1e-4 3e-3] [6e-2 1]} {[1e-4 3e-3] [6e-2 1]}
    {[1e-4 4e-2] [2e-1 2]} {[1e-4 3e-3] [3e-1 2]}
    {[2e-3 4e-2] [4e-1 10]} {[2e-3 4e-2] [4e-1 10]}
    {[1e-3 1e-2] [1e-1 2]} {[1e-3 1e-2] [2e-1 1]}};

tRanges.d2022_01_11.c1 = {
    {[2e-3 4e-2] [4e-1 1]} {[2e-3 4e-2] [3e-1 1]}
    {[2e-3 4e-2] [4e-1 1]} {[2e-3 4e-2] [3e-1 1]}
    {[6e-3 1e-1] [4e-1 2]} {[6e-3 1e-1] [3e-1 2]}
    {[1e-3 1e-2] [4e-1 2]} {[5e-3 5e-2] [1 10]}
    {[6e-3 1e-1] [1 10]} {[5e-3 5e-2] [1 10]}
    {[6e-3 1e-1] [1 10]} {[5e-3 5e-2] [1 10]}
    {[3e-3 2e-2] [0.3 5]} {[3e-3 2e-2] [0.3 5]}};
tRanges.d2022_01_11.c2 = {
    {[0.1 0.5] [1 2]} {[1e-2 1e-1] [1 3]}
    {[1e-2 5e-1] [1 10]} {[1e-2 1e-1] [10 100]}
    {[2e-3 2e-2] [1 10]} {[6e-3 6e-2] [1 10]}
    {[1e-2 1e-1] [1 10]} {[6e-3 6e-2] [1 10]}
    {[1e-2 1e-1] [3e-1 2]} {[6e-3 8e-2] [4e-1 6]}
    {[1e-2 1e-1] [1 10]} {[8e-3 8e-2] [1 10]}
    {[1e-2 2e-1] [0.5 5]} {[8e-3 8e-2] [0.5 5]}};
    
tRanges.d2021_07_23.c2 = {...
    {[1e-4 1e-2] [0.5 20]} {[1e-4 1e-2] [0.1 20]}
    {[1e-3 1e-2] [0.1 2]} {[1e-4 1e-2] [1 20]}
    {[1e-4 4e-3] [0.1 100]} {[1e-3 5e-2] [2 20]}
    {[1e-4 4e-3] [0.1 100]} {[1e-3 5e-2] [2 20]}
    {[1e-3 1e-2] [1 20]} {[1e-3 5e-2] [2 20]}
    {[1e-3 5e-2] [1 40]} {[1e-3 5e-2] [5 40]}
    {[1e-4 1e-2] [1 40]} {[1e-4 1e-2] [1 40]}
    {[1e-3 1e-1] [3 40]} {[1e-3 5e-2] [5 40]}
    {[1e-3 1e-1] [3 40]} {[1e-3 5e-2] [3 40]}
    {[1e-3 1e-1] [3 40]} {[1e-3 5e-2] [3 40]}};

tRanges.d2021_07_23.c1 = {...
    {[1e-4 5e-2] [1 50]} {[1e-4 5e-2] [1 50]}
    {[1e-4 5e-2] [1 50]} {[1e-4 5e-2] [1 50]}
    {[1e-4 5e-2] [1 50]} {[1e-4 5e-2] [1 50]}
    {[1e-4 5e-2] [1 50]} {[1e-4 5e-2] [1 50]}
    {[1e-4 5e-2] [1 50]} {[1e-4 5e-2] [1 50]}
    {[1e-4 5e-2] [1 50]} {[1e-4 5e-2] [1 50]}
    {[1e-4 5e-2] [1 50]} {[1e-4 5e-2] [1 50]}
    {[1e-4 1e-2] [1 50]} {[1e-4 5e-2] [1 50]}
    {[1e-4 5e-2] [0.1 0.8]} {[1e-4 5e-2] [1 50]}
    {[1e-4 1e-2] [0.04 0.4]} {[1e-4 5e-2] [1 50]}};

tRanges.d2021_07_26.c1 = {...
    {[1e-4 1e-2] [1e-1 3e-1]} {[1e-4 1e-2] [1e-1 3e-1]}
    {[1e-4 1e-2] [1e-1 3e-1]} {[1e-4 0.6e-2] [5e-2 3e-1]}
    {[1e-4 1e-2] [1e-1 3e-1]} {[1e-4 0.6e-2] [5e-2 3e-1]}
    {[1e-4 1e-2] [1e-1 3e-1]} {[1e-4 0.6e-2] [5e-2 3e-1]}
    {[1e-4 1e-2] [1e-1 3e-1]} {[1e-4 0.6e-2] [5e-2 3e-1]}
    {[1e-4 1e-2] [1e-1 3e-1]} {[1e-4 0.6e-2] [5e-2 3e-1]}
    {[1e-4 1e-2] [1e-1 3e-1]} {[1e-4 0.6e-2] [5e-2 3e-1]}
    {[1e-4 1e-2] [2e-1 7e-1]} {[1e-4 0.6e-2] [2e-1 1]}};

tRanges.d2021_07_27.c1 = {...
    {[1e-3 1e-2] [0.4 2]} {[5e-3 2e-2] [0.1 0.8]}
    {[1e-3 1e-2] [0.4 2]} {[5e-3 2e-2] [0.1 0.8]}
    {[5e-3 5e-2] [0.1 1]} {[5e-3 2e-2] [0.4 5]}
    {[5e-3 5e-2] [0.1 1]} {[5e-3 2e-2] [0.4 5]}
    {[1e-2 1e-1] [1 50]} {[1e-2 1e-1] [1 50]}
    {[1e-2 1e-1] [1 50]} {[1e-2 1e-1] [1 50]}
    {[5e-3 5e-2] [1 8]} {[5e-3 2e-1] [1 50]}
    {[5e-3 5e-2] [1 8]} {[5e-3 2e-2] [0.4 5]}};

end

function [wRanges] = get_wRanges_struct(dayDirs)
% This has numbers from LatB data
wRanges = struct(strcat('d',dayDirs{end}), struct('c1', {{}}));

%% wRanges with 1 low-frequency corner

wRanges.d2022_02_01.c1 = {
    {} {}
    {} {}
    {} {}
    {[1 40]} {[3 20]}
    {[2e-2 2]} {[2e-2 2]}
    {[2e-2 2]} {[2e-2 2]}
    {[2e-2 2]} {[2e-2 2]}
    {[2e-2 2]} {[2e-2 2]}
    {[2e-2 2]} {[2e-2 2]}
    {[2e-2 2]} {[2e-2 2]}};

wRanges.d2022_01_18.c1 = {
    {[1e-2 1]} {[1e-1 2]}
    {[1e-2 1]} {[1e-1 2]}
    {[6e-1 6]} {[1e-1 4]}
    {[6e-1 6]} {[1e-1 4]}
    {[1e-1 6]} {[1e-1 4]}
    {[1e-2 1]} {[1e-2 1]}};

wRanges.d2022_01_13.c1 = {
    {[2e-2 20]} {[2e-2 4]}
    {[6e-1 8]} {[6e-1 2]}
    {[6e-1 8]} {[2e-1 2]}
    {[3e-2 0.7]} {[2e-1 0.5]}
    {[2e-2 1]} {[2e-2 1]}
    {[2e-2 1]} {[2e-2 1]}
    {[2 5]} {[2 5]}};

wRanges.d2022_01_13.c2 = {
    {} {}
    {[1e-1 4]} {[1e-1 2]}
    {[2e-1 3]} {[2e-1 2]}
    {[2e-1 3]} {[7e-2 1]}
    {[1e-1 3]} {[7e-2 1]}
    {} {[3e-2 7e-1]}
    {[1e-1 2]} {[7e-2 1]}};

wRanges.d2022_01_11.c1 = {
    {[3e-1 1]} {[3e-1 1]}
    {[2e-1 0.8]} {[0.098 0.8]}
    {[3e-2 0.5]} {}
    {} {}
    {} {}
    {} {}
    {} {}};

wRanges.d2022_01_11.c2 = {
    {[0.1 1]} {[0.1 1]}
    {[6e-2 0.8]} {}
    {} {}
    {} {}
    {[3e-2 1]} {[3e-2 1]}};

wRanges.d2021_07_27.c2 = {...
    {[2e-2 1]} {[2e-2 1]};
    {[2e-2 1]} {[2e-2 1]};
    {[2e-2 0.8]} {};
    {[2e-2 0.8]} {};
    {} {};
    {} {};
    {} {};
    {[1e-2 1.5e-1]} {};};
wRanges.d2021_07_27.c1 = {...
    {[1e-2 2]} {[1e-2 5]};
    {[1e-2 5]} {[1e-2 6]};
    {[1e-2 2]} {[1e-2 1]};
    {[1e-2 2]} {[1e-1 2]};
    {[1e-2 1]} {[1e-2 1]};
    {[1e-1 3]} {[1e-2 1]};
    {[1e-2 1]} {[1e-2 1]};
    {[1e-2 1]} {[1e-2 1]};
    {[1e-2 1]} {[1e-2 1]}};
wRanges.d2021_07_26.c1 = {...
    {[1e-2 10]} {[1e-2 10]};
    {[1e-2 5]} {[1e-2 6]};
    {[1e-2 10]} {[1e-2 10]};
    {[6e-2 2]} {[6e-2 2]};
    {[1e-2 1]} {[1e-2 1]};
    {[1e-1 3]} {[1e-2 3]};
    {[1e-1 1]} {[2e-1 1]};
    {[1e-1 3]} {[1e-1 1]}};
% wRanges.d2021_07_23.c3 = {...
%     {[100 1e4]} {[20 8e2]};
%     {[100 1e4]} {[20 8e2]};
%     {[100 1e4]} {[20 8e2]};
%     {[100 1e4]} {[20 8e2]};
%     {[100 1e4]} {[20 8e2]};
%     {[100 1e4]} {[20 8e2]};
%     {[1e-2 0.8]} {[100 1e4]};
%     {[100 1e4]} {[20 8e2]};
%     {[100 1e4]} {[20 1e3]}};
wRanges.d2021_07_23.c2 = {...
    {[1e-2 1]} {[5 80]};
    {[3 50]} {[2 30]};
    {[3 50]} {[0.5 5]};
    {[3 50]} {[0.5 5]};
    {[0.5 4]} {[0.5 4]};
    {[3e-1 5]} {[3e-1 3]};
    {[1 10]} {[1 10]}; %
    {[2e-1 10]} {[2e-1 8]};
    {[4e-1 3]} {[1e-1 3]};
    {[1 5]} {[1 5]};};
wRanges.d2021_07_23.c1 = {...
    {[1e-1 5]} {[1e-1 5]};
    {[5e-1 500]} {[1e-1 5]};
    {[1e-1 5]} {[1e-1 5]};
    {[1e-1 3]} {[1e-1 3]};
    {[1e-1 3]} {[1e-1 3]};
    {[1e-1 5]} {[1e-1 5]};
    {[1e-2 2]} {[1e-2 2]}; %
    {[1e-2 30]} {[1e-2 8]};
    {[1e-2 1]} {[1e-2 2]};
    {[1e-2 1]} {[1e-2 2]}};

end

function [tRanges] = get_tRanges_struct(dayDirs)
% This has numbers from LatB data
tRanges = struct(strcat('d',dayDirs{end}), struct('c1', {{}}));

%% tRanges used for determining highpass frequency
tRanges.d2022_02_01.c1 = {
    {[2 3]} { [2 3]} 
    {[10 100]} {[10 100]}
    {[2 20]} { [4 20]}
    {[0.1 0.2]} {[0.1 0.2]}
    {[0.1 0.2]} {[0.1 0.2]}
    {[0.1 1]} {[0.1 1]}
    {[0.1 1]} {[0.1 0.6]}
    {[0.1 1]} {[0.1 0.6]}
    {[0.1 1]} {[0.1 0.6]}
    {[0.1 1]} {[0.1 0.6]}};

tRanges.d2022_01_18.c1 = {
    { [10 20]} { [8 30]}
    {[5 20]}   {[5 20]}
    {[10 100]} {[10 100]}
    {[10 100]} {[10 100]}
    {[20 100]} {[20 100]}
    {[60 200]} {[60 200]}};

tRanges.d2022_01_13.c1 = {
    { [10 100]} { [10 100]}
    {[10 100]} {[10 100]} 
    {[10 100]} {[10 100]}
    {[10 100]} {[10 100]}
    {[40 100]} {[40 100]}
    { [7 100]} {[7 100]}
    { [7 100]} {[7 100]}};
tRanges.d2022_01_13.c2 = {
    { [10 100]} {[10 100]}
    {[8 20]} {[3 20]}
    {[8 40]} {[8 40]}
    {[10 100]} { [10 100]}
    {[10 100]} { [10 100]}
    {} {[30 100]}
    {[10 100]} {[20 100]}};

tRanges.d2022_01_11.c1 = {
    {[10 100]} {[10 100]}
    {[10 100]} {[10 100]}
    {[20 40]} {}
    {[50 100]} {[50 100]}
    {[20 40]}   {[20 40]}
    {}   {}
    {[10 30]}  {[30 50]}};
tRanges.d2022_01_11.c2 = {
    {[1 2]} {[1 3]}
    {[1 10]} { [10 100]}
    {[1 10]} { [1 10]}
    {[1 10]} { [1 10]}
    {[3e-1 2]} {[4e-1 6]}
    {[1 10]} {[1 10]}
    {[0.5 5]} { [0.5 5]}};
    
tRanges.d2021_05_17.c2 = {
    { [1 100]} {[1 100]}
    { [1 100]} {[1 100]}
    { [1 100]} {[1 100]}
    { [1 100]} {[1 100]}
    { [1 100]} {[1 100]}};

tRanges.d2021_05_17.c1 = {
    {[10 100]} { [10 100]}
    {[1 10]} {[1 100]}
    {[1 100]} { [1 100]}
    {[1 100]} { [1 100]}
    {[1 100]} { [1 100]}
    {[1 100]} { [1 100]}};

tRanges.d2021_07_16.c1 = {
    {[2e-1 2]} {[10e-2 100]}
    {[2e-1 2]} {[10e-2 100]}
    {[2e-1 2]} {[10e-2 100]}
    {[2e-1 2]} {[10e-2 100]}%
    {[2e-1 2]} {[10e-2 100]}
    {[2e-1 2]} {[10e-2 100]}
    {[2e-1 2]} {[10e-2 100]}};

tRanges.d2021_07_13.c1 = {...
    {[1 100]} {[1 100]}
    {[1 100]} {[1 100]}
    {[1 100]} {[1 100]}
    {[1 100]} {[1 100]}
    {[1 100]} {[1 100]}
    {[1 100]} {[1 100]}
    {[1 100]} {[1 100]}
    {[1 100]} {[1 100]}
    {[1 100]} {[1 100]}
    {[1 100]} {[1 100]}
    {[1 100]} {[1 100]}
    {[1 100]} {[1 100]}};

tRanges.d2021_07_23.c3 = {...
    {} {}
    {} {}
    {} {}
    {} {}
    {} {}
    {} {}
    {[5 50]} {}
    {[5 50]} {}
    {[5 50]} {}};

tRanges.d2021_07_23.c2 = {...
    {[0.5 20]} { [0.1 20]}
    {[0.1 2]} { [1 20]}
    {[0.1 100]} { [2 20]}
    {[0.1 100]} { [2 20]}
    {[1 20]} {[2 20]}
    {[1 40]} {[5 40]}
    {[1 40]} {[1 40]}
    {[3 40]} {[5 40]}
    {[3 40]} {[3 40]}
    {[3 40]} {[3 40]}};

tRanges.d2021_07_23.c1 = {...
    {[1 50]} {[1 50]}
    {[1 50]} {[1 50]}
    {[1 50]} {[1 50]}
    {[1 50]} {[1 50]}
    {[1 50]} {[1 50]}
    {[1 50]} {[1 50]}
    {[1 50]} {[1 50]}
    {[1 50]} {[1 50]}
    {[1 50]} {[1 50]}
    {[1 50]} {[1 50]}};

tRanges.d2021_07_26.c1 = {...
    {[1 100]} { [1 100]}
    {[1 100]} { [1 100]}
    {[1 100]} { [1 100]}
    {[1 100]} { [1 100]}
    {[1 100]} { [1 100]}
    {[1 100]} { [1 100]}
    {[1 100]} { [1 100]}
    {[1 100]} { [1 100]}};

tRanges.d2021_07_27.c2 = {...
    { [5 50]} {[5 50]}
    { [5 50]} {[5 50]}
    { [5 50]} {[5 50]}
    { [5 50]} {[5 50]}
    { [5 50]} {[5 50]}
    { [5 50]} {[5 50]}
    { [5 50]} {[5 50]}
    { [5 50]} {[5 50]}};

tRanges.d2021_07_27.c1 = {...
    {[1 50]} {[1 50]}
    {[1 50]} {[1 50]}
    {[1 50]} {[1 50]}
    {[1 50]} {[1 50]}
    {[1 50]} {[1 50]}
    {[1 50]} {[1 50]}
    {[1 50]} {[1 50]}
    {[1 50]} {[1 50]}
    {[1 50]} {[1 50]}};
end


% function [tRanges] = get_tRanges_struct(dayDirs)
% % This has numbers from LatB data
% tRanges = struct(strcat('d',dayDirs{end}), struct('c1', {{}}));
% 
% %% tRanges used for determining highpass frequency
% tRanges.d2022_02_01.c1 = {
%     {[0 1] [2 3]} {[0 1] [2 3]} 
%     {[1e-2 1] [10 100]} {[1e-2 1] [10 100]}
%     {[0.1 1] [2 20]} {[0.1 0.4] [4 20]}
%     {[2e-3 1e-2] [0.1 0.2]} {[2e-3 1e-2] [0.1 0.2]}
%     {[2e-3 1e-2] [0.1 0.2]} {[2e-3 1e-2] [0.1 0.2]}
%     {[2e-3 1e-2] [0.1 1]} {[2e-3 1e-2] [0.1 1]}
%     {[2e-3 1e-2] [0.1 1]} {[2e-3 1e-2] [0.1 0.6]}
%     {[2e-3 1e-2] [0.1 1]} {[2e-3 1e-2] [0.1 0.6]}
%     {[2e-3 1e-2] [0.1 1]} {[2e-3 1e-2] [0.1 0.6]}
%     {[2e-3 1e-2] [0.1 1]} {[2e-3 1e-2] [0.1 0.6]}};
% 
% tRanges.d2022_01_18.c1 = {
%     {[1e-2 1] [10 20]} {[1e-2 1] [8 30]}
%     {[0.3 2] [5 20]} {[0.3 2] [5 20]}
%     {[0.1 1] [10 100]} {[0.1 1] [10 100]}
%     {[0.1 1] [10 100]} {[0.1 1] [10 100]}
%     {[0.1 1] [20 100]} {[0.1 1] [20 100]}
%     {[0.1 1] [60 200]} {[0.1 1] [60 200]}};
% 
% tRanges.d2022_01_13.c1 = {
%     {[0.08 0.5] [10 100]} {[0.1 0.8] [10 100]}
%     {[0.2 1] [10 100]} {[0.2 0.4] [10 100]} 
%     {[0.1 1] [10 100]} {[0.1 1] [10 100]}
%     {[0.1 1] [10 100]} {[0.1 1] [10 100]}
%     {[0.2 2] [40 100]} {[0.2 2] [40 100]}
%     {[0.1 0.6] [7 100]} {[0.1 1] [7 100]}
%     {[0.1 0.3] [7 100]} {[0.08 0.3] [7 100]}};
% tRanges.d2022_01_13.c2 = {
%     {[6e-2 2e-1] [10 100]} {[6e-2 2e-1] [10 100]}
%     {[6e-2 1] [8 20]} {[6e-2 1] [3 20]}
%     {[6e-2 1] [8 40]} {[6e-2 1] [8 40]}
%     {[6e-2 1] [10 100]} {[6e-2 1] [10 100]}
%     {[2e-1 2] [10 100]} {[3e-1 2] [10 100]}
%     {} {[4e-1 10] [30 100]}
%     {[1e-1 2] [10 100]} {[2e-1 1] [20 100]}};
% 
% tRanges.d2022_01_11.c1 = {
%     {[4e-1 1] [10 100]} {[3e-1 1] [10 100]}
%     {[4e-1 1] [10 100]} {[3e-1 1] [10 100]}
%     {[4e-1 2] [20 40]} {}
%     {[4e-1 2] [50 100]} {[1 10] [50 100]}
%     {[1 10] [20 40]}   {[1 10] [20 40]}
%     {}   {}
%     {[0.3 5] [10 30]}  {[0.3 5] [30 50]}};
% tRanges.d2022_01_11.c2 = {
%     {[0.1 0.5] [1 2]} {[1e-2 1e-1] [1 3]}
%     {[1e-2 5e-1] [1 10]} {[1e-2 1e-1] [10 100]}
%     {[2e-3 2e-2] [1 10]} {[6e-3 6e-2] [1 10]}
%     {[1e-2 1e-1] [1 10]} {[6e-3 6e-2] [1 10]}
%     {[1e-2 1e-1] [3e-1 2]} {[6e-3 8e-2] [4e-1 6]}
%     {[1e-2 1e-1] [1 10]} {[8e-3 8e-2] [1 10]}
%     {[1e-2 2e-1] [0.5 5]} {[8e-3 8e-2] [0.5 5]}};
%     
% tRanges.d2021_05_17.c2 = {
%     {[1e-2 1e-1] [1 100]} {[1e-2 1e-1] [1 100]}
%     {[1e-2 1e-1] [1 100]} {[1e-2 1e-1] [1 100]}
%     {[1e-2 1e-1] [1 100]} {[1e-2 1e-1] [1 100]}
%     {[1e-2 1e-1] [1 100]} {[1e-2 1e-1] [1 100]}
%     {[1e-2 1e-1] [1 100]} {[1e-2 1e-1] [1 100]}};
% 
% tRanges.d2021_05_17.c1 = {
%     {[1e-2 1] [10 100]} {[1e-2 0.5] [10 100]}
%     {[3e-3 0.08] [1 10]} {[3e-3 0.08] [1 100]}
%     {[1e-2 1e-1] [1 100]} {[1e-2 1e-1] [1 100]}
%     {[1e-2 1e-1] [1 100]} {[1e-2 1e-1] [1 100]}
%     {[1e-2 1e-1] [1 100]} {[1e-2 1e-1] [1 100]}
%     {[1e-2 1e-1] [1 100]} {[1e-2 1e-1] [1 100]}};
% 
% tRanges.d2021_07_16.c1 = {
%     {[1e-4 1e-2] [2e-1 2]} {[1e-4 1e-2] [10e-2 100]}
%     {[1e-4 1e-2] [2e-1 2]} {[1e-4 1e-2] [10e-2 100]}
%     {[1e-4 1e-2] [2e-1 2]} {[1e-4 1e-2] [10e-2 100]}
%     {[1e-4 1e-2] [2e-1 2]} {[1e-4 1e-2] [10e-2 100]}%
%     {[1e-4 1e-2] [2e-1 2]} {[1e-4 5e-3] [10e-2 100]}
%     {[1e-4 1e-2] [2e-1 2]} {[1e-4 5e-3] [10e-2 100]}
%     {[1e-4 1e-2] [2e-1 2]} {[1e-4 5e-3] [10e-2 100]}};
% 
% tRanges.d2021_07_13.c1 = {...
%     {[1e-2 4e-1] [1 100]} {[1e-2 4e-1] [1 100]}
%     {[1e-2 2e-1] [1 100]} {[1e-2 2e-1] [1 100]}
%     {[1e-2 2e-1] [1 100]} {[1e-2 2e-1] [1 100]}
%     {[1e-2 2e-1] [1 100]} {[1e-2 2e-1] [1 100]}
%     {[1e-2 2e-1] [1 100]} {[1e-2 2e-1] [1 100]}
%     {[1e-2 2e-1] [1 100]} {[1e-2 2e-1] [1 100]}
%     {[1e-2 2e-1] [1 100]} {[1e-2 2e-1] [1 100]}
%     {[1e-2 2e-1] [1 100]} {[1e-2 2e-1] [1 100]}
%     {[1e-2 2e-1] [1 100]} {[1e-2 2e-1] [1 100]}
%     {[1e-2 2e-1] [1 100]} {[1e-2 2e-1] [1 100]}
%     {[1e-2 2e-1] [1 100]} {[1e-2 2e-1] [1 100]}
%     {[1e-2 2e-1] [1 100]} {[1e-2 2e-1] [1 100]}};
% 
% tRanges.d2021_07_23.c3 = {...
%     {} {}
%     {} {}
%     {} {}
%     {} {}
%     {} {}
%     {} {}
%     {[1e-2 1e-1] [5 50]} {}
%     {[1e-2 1e-1] [5 50]} {}
%     {[1e-2 1e-1] [5 50]} {}};
% 
% tRanges.d2021_07_23.c2 = {...
%     {[1e-4 1e-2] [0.5 20]} {[1e-4 1e-2] [0.1 20]}
%     {[1e-3 1e-2] [0.1 2]} {[1e-4 1e-2] [1 20]}
%     {[1e-4 4e-3] [0.1 100]} {[1e-3 5e-2] [2 20]}
%     {[1e-4 4e-3] [0.1 100]} {[1e-3 5e-2] [2 20]}
%     {[1e-3 1e-2] [1 20]} {[1e-3 5e-2] [2 20]}
%     {[1e-3 5e-2] [1 40]} {[1e-3 5e-2] [5 40]}
%     {[1e-4 1e-2] [1 40]} {[1e-4 1e-2] [1 40]}
%     {[1e-3 1e-1] [3 40]} {[1e-3 5e-2] [5 40]}
%     {[1e-3 1e-1] [3 40]} {[1e-3 5e-2] [3 40]}
%     {[1e-3 1e-1] [3 40]} {[1e-3 5e-2] [3 40]}};
% 
% tRanges.d2021_07_23.c1 = {...
%     {[1e-4 5e-2] [1 50]} {[1e-4 5e-2] [1 50]}
%     {[1e-4 5e-2] [1 50]} {[1e-4 5e-2] [1 50]}
%     {[1e-4 5e-2] [1 50]} {[1e-4 5e-2] [1 50]}
%     {[1e-4 5e-2] [1 50]} {[1e-4 5e-2] [1 50]}
%     {[1e-4 5e-2] [1 50]} {[1e-4 5e-2] [1 50]}
%     {[1e-4 5e-2] [1 50]} {[1e-4 5e-2] [1 50]}
%     {[1e-4 5e-2] [1 50]} {[1e-4 5e-2] [1 50]}
%     {[1e-4 1e-2] [1 50]} {[1e-4 5e-2] [1 50]}
%     {[1e-4 5e-2] [0.1 0.8] [1 50]} {[1e-4 5e-2] [1 50]}
%     {[1e-4 1e-2] [0.04 0.4] [1 50]} {[1e-4 5e-2] [1 50]}};
% 
% tRanges.d2021_07_26.c1 = {...
%     {[1e-4 1e-2] [1 100]} {[1e-4 0.4e-2] [1 100]}
%     {[1e-4 1e-2] [1 100]} {[1e-4 0.4e-2] [1 100]}
%     {[1e-4 1e-2] [1 100]} {[1e-4 0.4e-2] [1 100]}
%     {[1e-4 1e-2] [1 100]} {[1e-4 0.4e-2] [1 100]}
%     {[1e-4 1e-2] [1 100]} {[1e-4 0.4e-2] [1 100]}
%     {[1e-4 1e-2] [1 100]} {[1e-4 0.4e-2] [1 100]}
%     {[1e-4 1e-2] [1 100]} {[1e-4 0.4e-2] [1 100]}
%     {[1e-4 1e-2] [1 100]} {[1e-4 0.4e-2] [1 100]}};
% 
% tRanges.d2021_07_27.c2 = {...
%     {[1e-4 1e-2] [5 50]} {[3e-4 1e-2] [5 50]}
%     {[1e-4 1e-2] [5 50]} {[3e-4 1e-2] [5 50]}
%     {[1e-4 1e-2] [5 50]} {[3e-4 1e-2] [5 50]}
%     {[1e-4 1e-2] [5 50]} {[3e-4 1e-2] [5 50]}
%     {[1e-4 1e-2] [5 50]} {[3e-4 1e-2] [5 50]}
%     {[1e-4 1e-2] [5 50]} {[3e-4 1e-2] [5 50]}
%     {[1e-4 1e-2] [5 50]} {[3e-4 1e-2] [5 50]}
%     {[1e-4 1e-2] [5 50]} {[3e-4 1e-2] [5 50]}};
% 
% tRanges.d2021_07_27.c1 = {...
%     {[1e-2 1e-1] [1 50]} {[1e-2 1e-1] [1 50]}
%     {[1e-2 1e-1] [1 50]} {[1e-2 1e-1] [1 50]}
%     {[1e-2 1e-1] [1 50]} {[1e-2 1e-1] [1 50]}
%     {[1e-2 1e-1] [1 50]} {[1e-2 1e-1] [1 50]}
%     {[1e-2 1e-1] [1 50]} {[1e-2 1e-1] [1 50]}
%     {[1e-2 1e-1] [1 50]} {[1e-2 1e-1] [1 50]}
%     {[1e-2 1e-1] [1 50]} {[1e-2 1e-1] [1 50]}
%     {[1e-2 1e-1] [1 50]} {[1e-2 1e-1] [1 50]}
%     {[1e-2 1e-1] [1 50]} {[1e-2 1e-1] [1 50]}};
% end

function Range = Range_getter(Ranges, day, cIdx, fIdx)
if ~isstruct(Ranges)
    tmp = whos('Ranges');
    error('Ranges needs to be a struct, instead got: %s\n', tmp.class)
end
day = ['d' day];
if isfield(Ranges, day)
    c = ['c' num2str(cIdx)];
    if isfield(Ranges.(day), c)
        if size(Ranges.(day).(c), 1) >= fIdx
            Range = Ranges.(day).(c)(fIdx,:);
        else
            Range = {{} {}};
        end
    else
        Range = {{} {}};
    end
else
    Range = {{} {}};
end
end

function N_extraPlots(nP, m, fps)
drawnow
for idx = 1:2
% [dydx, t] = msd_gradientor(m{1}(:,1), m{1}(:,2), 'lsq', nP);
[dydx(:,idx), t] = msd_gradientor(m{idx}(:,1), m{idx}(:,2), 'lsq', nP);
if any( length(get(gcf,'Children')) == [8 12] )
    ax = subplot(3,2,idx); 
else
    ax = subplot(1,2,idx);
    if length(ax.Children) > 1
        h = ax.Children(2);
        legend(h,sprintf('α = %.2g',fps(1,1,idx)))
        ax.Children(end).LineWidth = 4;
    end
end
grid off
% yyaxis right; cla; plot(t,dydx(:,idx));% legend off; 
% ylim([0 2])


end
% subplot(1,2,2); yyaxis right; cla; plot(t,dydx(:,2)); legend off; ylim([0 1])
% subplot(2,2,1); yyaxis right; cla; plot(t,dydx(:,1)); legend off
% subplot(2,2,2); yyaxis right; cla; plot(t,dydx(:,2)); legend off
end

function splitMSD(accumulated)
% This is an interesting dataset: the first 5 minutes are static error
% dominated, then suddenly it gains new life and the MSD goes very linear
dayIdx = 1; cellIdx = 1; fIdx = 1;
tcrops = {[1 260e3] [280e3 1e6]};

m = accumulated{dayIdx}{1,cellIdx}(fIdx).msd;
t = m.tracks;

t2 = cell(length(tcrops) * length(t), 1);
for idx = 0:length(tcrops)-1
    for jdx = 1:length(t)
        fprintf('Taking %i, \twriting into%i\n',jdx, idx*length(t) + jdx)
        t2{idx*length(t) + jdx} = t{jdx}(tcrops{idx+1}(1):tcrops{idx+1}(2),:);
    end
end
m = m.addAll(t2);
m = m.computeMSD;
figure(103)
clf
for plt = 1:2
    legCell = {};
    jdx = 1;
    ax = subplot(1,2,plt);
    hold on
    for idx = 1:length(m.msd)/2
        fprintf('Line %i\tmsd %i\n',idx,plt+(idx-1)*2)
        h(jdx) = loglog(m.msd{plt+(idx-1)*2}(:,1), ...
            m.msd{plt+(idx-1)*2}(:,2),'LineWidth',3);
        legCell{jdx} = sprintf('%gs to %gs', round(m.tracks{plt+(idx-1)*2}([1 end],1)));
        jdx = jdx + 1;
    end
    ax.XScale = 'log';
    ax.YScale = 'log';
    legend(h([3 1 2]), legCell([3 1 2]))
end
end 
